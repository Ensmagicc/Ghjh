<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>عرض المنتجات - ملابس ألاء</title>
    
    <!-- الخطوط العربية -->
    <link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@400;600;700&family=El+Messiri:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- أيقونات Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* CSS الكامل لصفحة المنتجات */
        :root {
            --primary-coffee: #f9f5f2;
            --accent-coffee: #6F4E37;
            --light-coffee: #d7ccc8;
            --text-dark: #3e2723;
            --star-filled: #FFD700;
            --star-empty: #e0e0e0;
            --header-gradient: linear-gradient(135deg, #8B4513 0%, #6F4E37 50%, #8B4513 100%);
            --header-shadow: 0 4px 15px rgba(111, 78, 55, 0.2);
            --discount-color: #dc3545;
            --new-price-color: #28a745;
            --old-price-color: #dc3545;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            -webkit-user-select: none; 
        }

        /* إصلاح مشكلة التمرير في فيسبوك لايت */
        html, body {
            height: 100%;
            overflow: hidden; /* تغيير من auto إلى hidden */
            -webkit-overflow-scrolling: touch !important;
            position: fixed; /* مهم لفيسبوك لايت */
            width: 100%;
            touch-action: none; /* لمنع التكبير/التصغير */
        }

        body { 
            background-color: var(--primary-coffee); 
            color: var(--text-dark); 
            font-family: 'El Messiri', 'Segoe UI', sans-serif; 
            overflow: hidden; /* إبقاء hidden */
            position: fixed; /* مهم لفيسبوك لايت */
            width: 100%;
            height: 100%;
            overscroll-behavior-y: none; /* منع pull-to-refresh */
        }

        /* إصلاح خاص لمتصفحات فيسبوك لايت */
        @supports (-webkit-touch-callout: none) {
            html, body {
                height: 100%;
                overflow: hidden !important;
                position: fixed !important;
                width: 100% !important;
            }
            
            .main-container {
                overflow-y: scroll !important;
                -webkit-overflow-scrolling: touch !important;
                height: 100%;
                position: relative;
            }
        }

        /* الهيدر */
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 20px;
            background: var(--header-gradient); 
            position: fixed; 
            top: 0; 
            width: 100%; 
            z-index: 1000; 
            box-shadow: var(--header-shadow);
            min-height: 60px;
        }
        
        .logo { 
            font-family: 'Reem Kufi', cursive; 
            font-size: 24px;
            font-weight: 700;
            color: white; 
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
        }
        
        .header i { 
            font-size: 20px;
            color: white; 
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header i:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        /* الحاوية الرئيسية - إصلاح التمرير */
        .main-container { 
            margin-top: 60px;
            margin-bottom: 60px;
            height: calc(100vh - 120px);
            overflow-y: scroll !important; /* !important */
            -webkit-overflow-scrolling: touch !important; /* !important */
            position: relative;
            scrollbar-width: none;
            -ms-overflow-style: none;
            overscroll-behavior: contain; /* منع pull-to-refresh */
            -webkit-transform: translate3d(0,0,0); /* تسريع الأجهزة */
            transform: translate3d(0,0,0);
            will-change: transform; /* تحسين الأداء */
        }

        .main-container::-webkit-scrollbar {
            display: none;
        }

        /* شريط الفئات */
        .categories { 
            display: flex; 
            gap: 10px; 
            padding: 12px; 
            overflow-x: auto; 
            background: white; 
            position: sticky; 
            top: 0; 
            z-index: 999; 
            border-bottom: 1px solid var(--light-coffee);
            scrollbar-width: none;
            -ms-overflow-style: none;
            -webkit-overflow-scrolling: touch;
        }
        
        .categories::-webkit-scrollbar { 
            display: none; 
        }
        
        .category-item { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            background: #fff; 
            border: 1px solid var(--light-coffee); 
            padding: 8px 14px; 
            border-radius: 20px; 
            font-size: 13px; 
            white-space: nowrap; 
            cursor: pointer; 
            position: relative; 
            transition: all 0.3s ease; 
            -webkit-tap-highlight-color: transparent;
        }
        
        .category-item:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 3px 8px rgba(0,0,0,0.1); 
        }
        
        .category-item.active { 
            background: var(--accent-coffee); 
            color: #fff; 
            border-color: var(--accent-coffee); 
            box-shadow: 0 3px 8px rgba(111, 78, 55, 0.3); 
        }
        
        .category-item.pinned { 
            border-color: var(--accent-coffee); 
            border-width: 2px; 
            background: linear-gradient(135deg, #f9f5f2 0%, #fff 100%);
            position: relative;
        }
        
        .category-item.pinned::before {
            content: '';
            position: absolute;
            top: 2px;
            right: 2px;
            width: 6px;
            height: 6px;
            background: var(--accent-coffee);
            border-radius: 50%;
        }

        /* شبكة المنتجات - إصلاح التمرير */
        .products-container { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            padding: 10px; 
            min-height: calc(100vh - 180px);
            overflow: visible !important; /* تغيير من auto إلى visible */
            scrollbar-width: none;
            -ms-overflow-style: none;
            position: relative;
            -webkit-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
        }
        
        /* إزالة أي شريط تمرير من products-container */
        .products-container::-webkit-scrollbar {
            display: none;
            width: 0;
            height: 0;
        }
        
        .product-card { 
            background: white; 
            border-radius: 12px; 
            padding: 8px; 
            position: relative; 
            cursor: pointer; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
            -webkit-tap-highlight-color: transparent;
            animation: fadeIn 0.5s ease forwards;
            opacity: 0;
            -webkit-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .product-card:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
        }
        
        .product-img-wrapper { 
            position: relative; 
            aspect-ratio: 3/4; 
            border-radius: 8px; 
            overflow: hidden; 
            background: #f0f0f0; 
            -webkit-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
        }
        
        .product-img-wrapper img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            display: none; 
            pointer-events: none; 
            -webkit-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
        }
        
        .product-img-wrapper img.active { 
            display: block; 
        }

        /* قصاصة الخصم */
        .discount-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--discount-color);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .old-price {
            text-decoration: line-through;
            color: var(--old-price-color);
            font-size: 12px;
            margin-right: 5px;
        }

        .new-price {
            color: var(--new-price-color);
            font-weight: bold;
        }

        .regular-price {
            color: var(--accent-coffee);
            font-weight: bold;
        }

        /* أسهم التنقل بين الصور */
        .nav-arrow { 
            position: absolute; 
            top: 50%; 
            transform: translateY(-50%); 
            background: rgba(255,255,255,0.9); 
            border: none; 
            width: 28px; 
            height: 28px; 
            border-radius: 8px; 
            color: var(--accent-coffee); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 12px; 
            z-index: 5; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            -webkit-tap-highlight-color: transparent;
        }
        
        .prev-arrow { 
            left: 6px; 
        } 
        
        .next-arrow { 
            right: 6px; 
        }

        /* نظام النجوم */
        .stars-container { 
            display: flex; 
            gap: 3px; 
            margin-bottom: 5px; 
            justify-content: center; 
            align-items: center; 
        }
        
        .star { 
            font-size: 12px; 
            color: var(--star-empty); 
            cursor: pointer; 
            transition: color 0.2s; 
        }
        
        .star.filled { 
            color: var(--star-filled); 
        }
        
        .rating-count { 
            font-size: 10px; 
            color: #777; 
            text-align: center; 
            margin-top: 2px; 
        }

        /* رسالة المنتجات الفارغة */
        .empty-products {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
        }
        
        .empty-products i {
            font-size: 48px;
            color: #ccc;
            margin-bottom: 15px;
        }
        
        .empty-products p {
            color: #777;
            font-size: 16px;
        }

        /* الشريط السفلي */
        .bottom-nav { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            background: white; 
            display: flex; 
            justify-content: space-around; 
            padding: 10px 0; 
            border-top: 1px solid #f0f0f0; 
            z-index: 1000; 
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            min-height: 60px; 
        }
        
        .bottom-nav i { 
            position: relative;
            font-size: 20px; 
            color: var(--light-coffee); 
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 8px; 
            border-radius: 8px;
            width: 48px; 
            height: 48px; 
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }
        
        .bottom-nav i:hover { 
            color: var(--accent-coffee);
            background: rgba(111, 78, 55, 0.1);
            transform: translateY(-3px);
        }
        
        .bottom-nav i.active { 
            color: white; 
            background: var(--accent-coffee);
            box-shadow: 0 3px 8px rgba(111, 78, 55, 0.3);
        }

        /* شاشة التحميل */
        .products-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-coffee);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .products-loading .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(111, 78, 55, 0.2);
            border-radius: 50%;
            border-top-color: var(--accent-coffee);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { 
                transform: rotate(0deg); 
            }
            100% { 
                transform: rotate(360deg); 
            }
        }
        
        .products-loading .loading-text {
            color: var(--accent-coffee);
            font-family: 'Reem Kufi', cursive;
            font-size: 14px;
            font-weight: bold;
        }

        /* تفاصيل المنتج */
        .product-details {
            text-align: center;
            padding: 8px;
        }
        
        .product-name {
            font-size: 12px;
            margin-bottom: 5px;
            color: var(--text-dark);
            font-weight: bold;
        }
        
        .product-price-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-top: 5px;
        }

        /* إصلاح التمرير لفيسبوك لايت - مهم */
        .scroll-fix {
            -webkit-overflow-scrolling: touch !important;
            overflow-y: scroll !important;
            height: 100%;
        }

        /* طبقة إصلاح التمرير */
        .scroll-fix-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
        }

        /* منع التمرير الأفقي */
        .no-horizontal-scroll {
            overflow-x: hidden !important;
            max-width: 100vw;
        }
    </style>
</head>
<body>
    <!-- الهيدر -->
    <header class="header">
        <div class="logo">ملابس ألاء</div>
        <i class="fa-solid fa-bars" onclick="toggleSidebar()"></i>
    </header>

    <!-- الحاوية الرئيسية مع إصلاح التمرير -->
    <div class="main-container scroll-fix no-horizontal-scroll">
        <!-- شريط الفئات -->
        <div class="categories" id="catBar">
            <div class="category-item active" onclick="filterCat('الكل', this)">
                الكل <i class="fa-solid fa-table-cells-large"></i>
            </div>
            <!-- سيتم إضافة الفئات ديناميكياً -->
        </div>

        <!-- شبكة المنتجات -->
        <main class="products-container" id="grid">
            <!-- شاشة تحميل المنتجات داخل الهيكل -->
            <div class="products-loading" id="productsLoading">
                <div class="spinner"></div>
                <div class="loading-text">جاري تحميل المنتجات...</div>
            </div>
        </main>
    </div>

    <!-- الشريط السفلي -->
    <nav class="bottom-nav" id="bottomNav">
        <i class="fa-solid fa-house active" onclick="goHome()"></i>
        <i class="fa-solid fa-magnifying-glass" onclick="openSearch()"></i>
        <i class="fa-regular fa-heart" onclick="showDeliveryPrices()"></i>
        <i class="fa-solid fa-bag-shopping" onclick="showOrders()">
            <div id="orderNotification" class="notification-badge" style="display: none; position: absolute; top: -5px; right: -5px; background: #dc3545; color: white; font-size: 10px; font-weight: bold; min-width: 18px; height: 18px; border-radius: 9px; display: flex; align-items: center; justify-content: center; padding: 0 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">0</div>
        </i>
    </nav>

    <script>
        // بيانات المنتجات (يمكن استبدالها ببيانات حقيقية من قاعدة البيانات)
        let products = [
            {
                id: 1,
                name: "فستان صيفي",
                price: 3500,
                oldPrice: 4500,
                discount: 22,
                cat: "فساتين",
                colors: "أحمر، أزرق، أسود",
                desc: "فستان صيفي مريح وأنيق",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=فستان+صيفي"],
                sizes: ["S", "M", "L"],
                sizeType: "clothing"
            },
            {
                id: 2,
                name: "بلوزة قطنية",
                price: 2500,
                cat: "بلوزات",
                colors: "أبيض، بيج، رمادي",
                desc: "بلوزة قطنية مريحة للارتداء اليومي",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=بلوزة+قطنية"],
                sizes: ["M", "L", "XL"],
                sizeType: "clothing"
            },
            {
                id: 3,
                name: "جينز ضيق",
                price: 4500,
                oldPrice: 5000,
                discount: 10,
                cat: "بناطيل",
                colors: "أزرق غامق، أزرق فاتح، أسود",
                desc: "جينز ضيق عالي الجودة",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=جينز+ضيق"],
                sizes: ["28", "30", "32", "34"],
                sizeType: "clothing"
            },
            {
                id: 4,
                name: "حذاء رياضي",
                price: 6500,
                cat: "أحذية",
                colors: "أسود، أبيض، رمادي",
                desc: "حذاء رياضي مريح للأنشطة اليومية",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=حذاء+رياضي"],
                sizes: ["38", "39", "40", "41", "42"],
                sizeType: "shoes"
            },
            {
                id: 5,
                name: "سوار نسائي",
                price: 1500,
                cat: "إكسسوارات",
                colors: "فضي، ذهبي",
                desc: "سوار أنيق للنساء",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=سوار+نسائي"]
            },
            {
                id: 6,
                name: "حقيبة يد",
                price: 5500,
                oldPrice: 7000,
                discount: 21,
                cat: "حقائب",
                colors: "أسود، بني، أحمر",
                desc: "حقيبة يد أنيقة وعملية",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=حقيبة+يد"]
            },
            {
                id: 7,
                name: "تيشرت قطني",
                price: 2000,
                cat: "بلوزات",
                colors: "أسود، أبيض، رمادي",
                desc: "تيشرت قطني مريح",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=تيشرت+قطني"],
                sizes: ["S", "M", "L", "XL"],
                sizeType: "clothing"
            },
            {
                id: 8,
                name: "تنورة قصيرة",
                price: 2800,
                cat: "فساتين",
                colors: "أسود، أزرق، بني",
                desc: "تنورة قصيرة أنيقة",
                urls: ["https://via.placeholder.com/300x400/F9F5F2/6F4E37?text=تنورة+قصيرة"],
                sizes: ["S", "M", "L"],
                sizeType: "clothing"
            }
        ];

        // الفئات
        let categories = ["الكل", "فساتين", "بلوزات", "بناطيل", "أحذية", "إكسسوارات", "حقائب"];
        let currentCategory = "الكل";

        // التقييمات (بيانات تجريبية)
        let ratings = {
            1: { rating: 4.5, count: 12 },
            2: { rating: 3.8, count: 8 },
            3: { rating: 4.2, count: 15 },
            4: { rating: 4.7, count: 20 },
            5: { rating: 3.5, count: 5 },
            6: { rating: 4.0, count: 10 },
            7: { rating: 4.3, count: 7 },
            8: { rating: 4.1, count: 9 }
        };

        // دالة الكشف عن متصفح فيسبوك لايت
        function isFacebookLiteBrowser() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            return userAgent.indexOf("FacebookLite") > -1 || 
                   userAgent.indexOf("FBAN/FBIOS") > -1 ||
                   userAgent.indexOf("FB_IAB") > -1 ||
                   userAgent.indexOf("FBAV") > -1;
        }

        // دالة تطبيق إصلاحات فيسبوك لايت
        function applyFacebookLiteFixes() {
            if (isFacebookLiteBrowser()) {
                console.log("تم الكشف عن متصفح فيسبوك لايت - تطبيق الإصلاحات");
                
                // إصلاح التمرير
                document.body.style.overflow = 'hidden';
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
                document.body.style.height = '100%';
                
                const mainContainer = document.querySelector('.main-container');
                if (mainContainer) {
                    mainContainer.style.overflowY = 'scroll';
                    mainContainer.style.webkitOverflowScrolling = 'touch';
                    mainContainer.style.height = 'calc(100vh - 120px)';
                }
                
                // إضافة حدث لمنع التمرير الأفقي
                document.addEventListener('touchmove', function(e) {
                    if (e.touches.length === 1) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                return true;
            }
            return false;
        }

        // دالة تهيئة التطبيق
        function initApp() {
            // تطبيق إصلاحات فيسبوك لايت أولاً
            applyFacebookLiteFixes();
            
            // إخفاء شاشة التحميل بعد فترة قصيرة
            setTimeout(() => {
                document.getElementById('productsLoading').style.display = 'none';
            }, 500);
            
            // عرض الفئات
            renderCategories();
            
            // عرض المنتجات
            renderGrid(products, 'grid');
            
            // إعداد أحداث العناصر
            setupEventListeners();
            
            // إضافة حدث لمنع التمرير على body
            preventBodyScroll();
        }

        // دالة لمنع التمرير على body
        function preventBodyScroll() {
            document.body.addEventListener('touchmove', function(e) {
                // السماح بالتمرير فقط داخل main-container
                if (!e.target.closest('.main-container')) {
                    e.preventDefault();
                }
            }, { passive: false });
        }

        // دالة عرض الفئات
        function renderCategories() {
            const catBar = document.getElementById('catBar');
            let categoriesHTML = '';
            
            categories.forEach(cat => {
                const activeClass = cat === currentCategory ? 'active' : '';
                const pinnedClass = cat === 'فساتين' || cat === 'أحذية' ? 'pinned' : '';
                
                categoriesHTML += `
                    <div class="category-item ${activeClass} ${pinnedClass}" onclick="filterCat('${cat}', this)">
                        ${cat} <i class="fa-solid fa-tag"></i>
                    </div>
                `;
            });
            
            catBar.innerHTML = categoriesHTML;
        }

        // دالة عرض المنتجات
        function renderGrid(list, targetId) {
            const grid = document.getElementById(targetId);
            
            // إخفاء شاشة التحميل إذا كانت موجودة
            const productsLoading = document.getElementById('productsLoading');
            if (productsLoading && productsLoading.style.display !== 'none') {
                productsLoading.style.display = 'none';
            }
            
            // مسح المحتوى القديم
            grid.innerHTML = '';
            
            // إذا كانت القائمة فارغة
            if (list.length === 0) {
                grid.innerHTML = `
                    <div class="empty-products">
                        <i class="fa-solid fa-box-open"></i>
                        <p>لا توجد منتجات حالياً</p>
                    </div>`;
                return;
            }
            
            // إضافة البطاقات الجديدة
            list.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.id = `product-${product.id}`;
                
                const productRating = ratings[product.id] || { rating: 0, count: 0 };
                const starsHTML = renderStars(productRating);
                
                let discountBadge = '';
                if (product.discount && product.discount > 0) {
                    discountBadge = `<div class="discount-badge"><i class="fa-solid fa-percentage"></i> ${product.discount}%</div>`;
                }
                
                let imgHTML = '';
                let arrows = '';
                
                // إذا كان المنتج لديه صور متعددة
                if (product.urls && product.urls.length > 0) {
                    imgHTML = product.urls.map((url, i) => 
                        `<img src="${url}" class="${i===0?'active':''}" alt="${product.name}">`
                    ).join('');
                    
                    if (product.urls.length > 1) {
                        arrows = `
                            <button class="nav-arrow prev-arrow" onclick="event.stopPropagation(); shiftImg(this,-1)">
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <button class="nav-arrow next-arrow" onclick="event.stopPropagation(); shiftImg(this,1)">
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>`;
                    }
                }
                
                let priceHTML = '';
                if (product.oldPrice && product.oldPrice > product.price) {
                    priceHTML = `
                        <div class="product-price-container">
                            <div class="old-price">${product.oldPrice} د.ج</div>
                            <div class="new-price">${product.price} د.ج</div>
                        </div>`;
                } else {
                    priceHTML = `<div class="regular-price">${product.price} د.ج</div>`;
                }
                
                card.innerHTML = `
                    <div class="product-img-wrapper" onclick='viewProduct(${JSON.stringify(product).replace(/'/g, "\\'")})'>
                        ${discountBadge}
                        ${imgHTML}
                        ${arrows}
                    </div>
                    <div class="product-details" onclick='viewProduct(${JSON.stringify(product).replace(/'/g, "\\'")})'>
                        <div class="product-name">${product.name}</div>
                        ${starsHTML}
                        ${priceHTML}
                    </div>`;
                
                // إضافة البطاقة بسلاسة
                card.style.animationDelay = `${index * 0.03}s`;
                
                grid.appendChild(card);
            });
        }

        // دالة عرض النجوم
        function renderStars(ratingInfo) {
            let starsHTML = '<div class="stars-container">';
            
            for (let i = 1; i <= 5; i++) {
                const filled = ratingInfo.rating >= i;
                let starClass = 'star';
                if (filled) {
                    starClass += ' filled';
                }
                
                starsHTML += `<i class="fa-solid fa-star ${starClass}"></i>`;
            }
            
            starsHTML += '</div>';
            
            if (ratingInfo.count > 0) {
                starsHTML += `<div class="rating-count">${ratingInfo.rating.toFixed(1)} (${ratingInfo.count} تقييم)</div>`;
            } else {
                starsHTML += `<div class="rating-count">لا توجد تقييمات</div>`;
            }
            
            return starsHTML;
        }

        // دالة تصفية المنتجات حسب الفئة
        function filterCat(category, btn) {
            currentCategory = category;
            
            // تحديث حالة الفئات النشطة
            document.querySelectorAll('.category-item').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
            
            // تصفية المنتجات
            if (category === 'الكل') {
                renderGrid(products, 'grid');
            } else {
                const filteredProducts = products.filter(p => p.cat === category);
                renderGrid(filteredProducts, 'grid');
            }
        }

        // دالة التنقل بين الصور
        function shiftImg(btn, dir) {
            const imgs = btn.parentElement.querySelectorAll('img');
            let idx = Array.from(imgs).findIndex(i => i.classList.contains('active'));
            imgs[idx].classList.remove('active');
            idx = (idx + dir + imgs.length) % imgs.length;
            imgs[idx].classList.add('active');
        }

        // دالة عرض تفاصيل المنتج
        function viewProduct(product) {
            alert(`تفاصيل المنتج:\n\n${product.name}\nالسعر: ${product.price} د.ج${product.oldPrice ? ` (كان: ${product.oldPrice} د.ج)` : ''}\n${product.desc}\n\nالألوان: ${product.colors}\nالفئة: ${product.cat}`);
        }

        // دالة إعداد أحداث العناصر
        function setupEventListeners() {
            // إضافة حدث النقر على منتج
            document.addEventListener('click', function(e) {
                if (e.target.closest('.product-card')) {
                    // يمكن إضافة منطق إضافي هنا
                }
            });
            
            // تحسين التمرير لفيسبوك لايت
            if (isFacebookLiteBrowser()) {
                const mainContainer = document.querySelector('.main-container');
                if (mainContainer) {
                    mainContainer.addEventListener('touchstart', function() {
                        this.style.overflowY = 'scroll';
                    });
                    
                    mainContainer.addEventListener('touchend', function() {
                        setTimeout(() => {
                            this.style.overflowY = 'scroll';
                        }, 100);
                    });
                }
            }
        }

        // دوال الشريط السفلي
        function goHome() {
            currentCategory = 'الكل';
            renderCategories();
            renderGrid(products, 'grid');
        }

        function openSearch() {
            alert('ميزة البحث قيد التطوير');
        }

        function showDeliveryPrices() {
            alert('أسعار التوصيل:\n\n- توصيل للمنزل: 500 د.ج\n- توصيل للمكتب: 300 د.ج\n\nسيتم إضافة أسعار الولايات لاحقاً');
        }

        function showOrders() {
            alert('صفحة الطلبيات قيد التطوير');
        }

        function toggleSidebar() {
            alert('القائمة الجانبية قيد التطوير');
        }

        // تهيئة التطبيق عند تحميل الصفحة
        window.onload = initApp;
        
        // إصلاح التمرير عند تغيير حجم الشاشة
        window.addEventListener('resize', function() {
            if (isFacebookLiteBrowser()) {
                applyFacebookLiteFixes();
            }
        });
    </script>
</body>
</html>